{% set clients = hubdb_table_rows(module.clients_table, 'orderBy=-video') %}

{% set allIndustries = [] %}
{% set allProblems = [] %}
{% for client in clients %}
    {% do allIndustries.append(client.industry.name) %}
    {% for problem in client.problems %}
        {% do allProblems.append(problem.name) %}
    {% endfor %}
    <p>{{client.name}}</p>
{% endfor %}
{% set allIndustries = allIndustries|unique %}
{% set allProblems = allProblems|unique %}

<div class="filters">
    <div class="filter">
        <select data-select-industry>
            <option value="" disabled selected hidden>Filter by industry</option>
            {% for industry in allIndustries %}
                <option data-industry-option="{{industry}}">{{industry}}</option>
            {% endfor %}
        </select>
    </div>
    <div class="filter">
        <select data-select-problem value="">
            <option value="" disabled selected hidden>Filter by problem</option>
            {% for problem in allProblems %}
                <option data-problem-option="{{problem}}">{{problem}}</option>
            {% endfor %}
        </select>
    </div>
    <div class="applied-filters">
        {% for industry in allIndustries %}
            <div class="applied-filter hidden" data-applied-industry-filter="{{industry}}">{{industry}}<div class="remove-filter" data-remove-industry-filter="{{industry}}"></div></div>
        {% endfor %}
        {% for problem in allProblems %}
            <div class="applied-filter hidden" data-applied-problem-filter="{{problem}}">{{problem}}<div class="remove-filter" data-remove-problem-filter="{{problem}}"></div></div>
        {% endfor %}
    </div>
</div>
<hr />
<div class="grid-container">
    <div class="grid-sizer"></div>
    <div class="gutter-sizer"></div>
    {% for client in clients %}
        {% set problems = [] %}
        {% for problem in client.problems %}
            {% do  problems.append(problem.name) %}
        {% endfor %}
        {% if client.testimonial and client.description %}
            {% set class = "v-wide" %}
        {% elif client.testimonial or client.description %}
            {% set class = "wide" %}
        {% else %}
            {% set class = "" %}
        {% endif %}
        <div class="grid-item {{class}}" data-client-industry="{{client.industry.name}}" data-client-problems="{{problems|join(',')}}">
            <div class="client-container">
                <div class="client-left">
                    {% if client.logo %}
                        <div class="client-logo" style="background-image: url({{client.logo.url}})">
                        </div>
                    {% endif %}
                    <h3>{{client.name}}</h3>
                    <p>üîß <a href="">{{client.industry.name}}</a></p>
                    <p>‚ùì <a href="">{{problems|join(' | ')}}</a></p>
                </div>
                {% if client.description or client.testimonial %}
                    <div class="client-right">
                        {% if client.description %}
                            <p>{{client.description}}</p>
                        {% endif %}
                        {% if client.testimonial %}
                            <p>"{{client.testimonial}}" - <span class="testimonial-author">John Doe, Honest man</span></p>
                        {% endif %}
                        {% if client.case_study %}
                            <a
                                class="btn btn-md u-btn-primary btn-codurance-color text-uppercase custom-width-auto--lg case-study-button"
                                target="_blank"
                                href=""
                                rel="noopener noreferrer"
                                >Case Study</a
                                >
                        {% endif %}
                    </div>
                {% endif %}
            </div>
        </div>
        {% if client.video %}
            <div class="grid-item v-wide"  data-client-industry="{{client.industry.name}}" data-client-problems="{{problems|join(',')}}">
                <h3>{{client.name}}</h3>
                <div class="embed-video__video">
                    <div class="embed-video__video-inner">
                        <iframe width="100%" height="100%" src="https://www.youtube.com/embed/cL3DaHZ88ZQ" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                    </div>
                </div>
            </div>
        {% endif %}
    {% endfor %}
</div>

{{ require_js(get_asset_url("../js/imageLoaded.js")) }}
{{ require_js(get_asset_url("../../js/isotope.js"), "footer") }}
{{ require_js(get_asset_url("../../js/isotopePackery.js"), "footer") }}