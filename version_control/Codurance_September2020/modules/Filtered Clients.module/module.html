{{ require_css(get_asset_url("../../css/modules/filtered-clients.css")) }}

{% set clients = hubdb_table_rows(module.clients_table, 'orderBy=-testimonial&orderBy=-video&orderBy=description') %}

{% set allIndustries = [] %}
{% set allProblems = [] %}
{% set allServices = [] %}

{% for client in clients %}
  {% do allIndustries.append(client.industry.name) %}
  {% for service in client.services %}
    {% do allServices.append(service.name) %}
  {% endfor %}
  {% for problem in client.problems %}
    {% do allProblems.append(problem.name) %}
  {% endfor %}
{% endfor %}

{% set allIndustries = allIndustries|unique %}
{% set allProblems = allProblems|unique %}
{% set allServices = allServices|unique %}

<section class="clients-header__section">
  <div class="clients-header__container">
    <h1>Our Clients</h1>
    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam congue arcu dictum tortor egestas facilisis. Nam pellentesque efficitur leo, vel lacinia felis tristique id. Proin convallis ornare accumsan. In efficitur mauris dapibus tellus sollicitudin, sit amet sodales justo aliquam. Pellentesque odio purus, commodo id luctus ac, dictum tincidunt ligula. Suspendisse euismod non risus ac ornare. Praesent quam metus, laoreet eget libero et, condimentum imperdiet orci.</p>
  </div>
</section>

<div class="clients__filter">
  <div class="clients__filter-dropdown-container">
    <button class="clients__filter-dropdown-button" data-dropdown-button="industry">Industry<i class="clients__filter-dropdown-icon las la-angle-down"></i></button>
    <div class="clients__filter-dropdown-options hidden" data-dropdown-container="industry">
      {% for industry in allIndustries %}
        <button class="clients__filter-dropdown-option" data-industry-option="{{industry}}">
          {{industry}}
          <i class="clients__filter-dropdown-option-selected-icon las la-check-circle hidden"
            data-industry-option-selected="{{industry}}"></i>
        </button>
      {% endfor %}
    </div>
  </div>
  <div class="clients__filter-dropdown-container">
    <button class="clients__filter-dropdown-button" data-dropdown-button="problem">Problem<i class="clients__filter-dropdown-icon las la-angle-down"></i></button>
    <div class="clients__filter-dropdown-options hidden" data-dropdown-container="problem">
      {% for problem in allProblems %}
        <button class="clients__filter-dropdown-option" data-problem-option="{{problem}}">
          {{problem}}
          <i class="clients__filter-dropdown-option-selected-icon las la-check-circle hidden"
            data-problem-option-selected="{{problem}}"></i>
        </button>
      {% endfor %}
    </div>
  </div>
  <div class="clients__filter-dropdown-container">
    <button class="clients__filter-dropdown-button" data-dropdown-button="service">Service<i class="clients__filter-dropdown-icon las la-angle-down"></i></button>
    <div class="clients__filter-dropdown-options hidden" data-dropdown-container="service">
      {% for service in allServices %}
        <button class="clients__filter-dropdown-option" data-service-option="{{service}}">
          {{service}}
          <i class="clients__filter-dropdown-option-selected-icon las la-check-circle hidden"
            data-service-option-selected="{{service}}"></i>
        </button>
      {% endfor %}
    </div>
  </div>
</div>

<div class="clients-applied-filters__container">
  {% for industry in allIndustries %}
    <div class="clients-applied-filters__pill hidden" data-applied-industry-filter="{{industry}}">
      {{industry}}
      <i class="clients-applied-filters__remove-button las la-times" data-remove-industry-filter="{{industry}}"></i>
    </div>
  {% endfor %}
  {% for problem in allProblems %}
    <div class="clients-applied-filters__pill hidden" data-applied-problem-filter="{{problem}}">
      {{problem}}
      <i class="clients-applied-filters__remove-button las la-times" data-remove-problem-filter="{{problem}}"></i>
    </div>
  {% endfor %}
  {% for service in allServices %}
    <div class="clients-applied-filters__pill hidden" data-applied-service-filter="{{service}}">
      {{service}}
      <i class="clients-applied-filters__remove-button las la-times" data-remove-service-filter="{{service}}"></i>
    </div>
  {% endfor %}
</div>

<div class="clients-grid__container" data-grid-container>
  <div class="clients-grid__sizer"></div>
  <div class="clients-grid__gutter-sizer"></div>
  {% for client in clients %}
    {% set problems = [] %}
    {% for problem in client.problems %}
      {% do problems.append(problem.name) %}
    {% endfor %}
    {% set services = [] %}
    {% for service in client.services %}
      {% do services.append(service.name) %}
    {% endfor %}

    {% if client.description %}
      {% set class = "clients-grid__card--wide" %}
    {% else %}
      {% set class = "" %}
    {% endif %}

    {% if client.video %}
      <div class="clients-grid__card clients-grid__card--v-wide" data-client-industry="{{client.industry.name}}"
        data-client-problem="{{problems|join(',')}}" data-client-service="{{services|join(',')}}">
        <h3 class="client-card__name">{{client.name}}</h3>
        <div class="client-card__video">
          <div class="client-card__video-inner">
            <iframe width="100%" height="100%" src="https://www.youtube.com/embed/cL3DaHZ88ZQ"
              frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
              allowfullscreen>
            </iframe>
          </div>
        </div>
      </div>
    {% endif %}

    <div class="clients-grid__card {{class}}" data-client-industry="{{client.industry.name}}"
      data-client-problem="{{problems|join(',')}}" data-client-service="{{services|join(',')}}">
      <div class="client-card__container">
        {% if client.logo %}
          <div class="client-card__image" style="background-image: url({{client.logo.url}})">
          </div>
        {% endif %}
        <h3 class="client-card__name">{{client.name}}</h3>
        <p>
          <i class="client-card__icon las la-globe-africa"></i>
          <a href="">Visit website</a>
        </p>
        {% if client.description %}
          <p>{{client.description}}</p>
        {% endif %}
        <div class="client-card__info">
          <ul>
            <li>
              <i class="client-card__icon las la-wrench"></i>
              <a href="">{{client.industry.name}}</a>
            </li>
            {% for problem in problems %}
              <li>
                <i class="client-card__icon las la-exclamation"></i>
                <a href="">{{problem}}</a>
              </li>
            {% endfor %}
            {% for service in services %}
              <li>
                <i class="client-card__icon las la-briefcase"></i>
                <a href="">{{service}}</a>
              </li>
            {% endfor %}
          </ul>
          {% if client.case_study %}
            <a class="button-primary" href="{{client.case_study}}">
              Case Study at {{client.name}}
            </a>
          {% endif %}
        </div>
      </div>
    </div>

    {% if client.testimonial %}
      <div class="clients-grid__card" data-client-industry="{{client.industry.name}}"
        data-client-problem="{{problems|join(',')}}" data-client-service="{{services|join(',')}}">
        <div class="client-card__container">
          <h3 class="client-card__name">{{client.name}}</h3>
          <p>"{{client.testimonial}}"</p>
          <p class="client-card__testimonial-author">
            John Doe, Head of Product at {{client.name}}
          </p>
        </div>
      </div>
    {% endif %}
{% endfor %}
</div>

{{ require_js(get_asset_url("../js/imageLoaded.js")) }}
{{ require_js(get_asset_url("../../js/isotope.js"), "footer") }}
{{ require_js(get_asset_url("../../js/isotopePackery.js"), "footer") }}
