{{ require_css(get_asset_url("../../css/modules/menu-section.css")) }}

{% macro isActiveNode(link) %}
  {% set link_stripped = "/" + link | split('/', 3) | last %}
  {% if request.path == link_stripped %}
    {{ { "class": "menu-link active-item",
      "aria-current": "page"
      } | xmlattr
    }}
  {% endif %}
{% endmacro %}

{% macro link(node) %}
  <li>
    <a 
      href="{{ node.url if node.url else 'javascript:;' }}" 
      class="menu-link trigger"
      id="sub-menu-toggle-{{loop.index}}"
      aria-expanded="false"
      {{ isActiveNode(node.url) if node.url }}  
    >
        {{ node.linkLabel }}
    </a>
  </li>
{% endmacro %}

<nav aria-label="Main menu" class="navigation-primary" id="website-navigation-menu">
  <ul 
    class="submenu level-1 website-navigation-sub-menu" 
    id="sub-menu-services"
  >
    {% for item in module.menu_items %}
      {% set submenu = item.submenu.items %}

      <li class="menu-item{% if submenu %} has-submenu{% endif %}">
        <a href="{{ item.link.href if item.link.href else 'javascript:;' }}"
          class="menu-link trigger" 
          id="sub-menu-toggle-{{loop.index}}"
          aria-controls="sub-menu-services-{{loop.index}}"
          aria-expanded="false"
          {{ isActiveNode(item.link.href) if item.link.href }}  
        >
          {{ item.title }}
        </a>
          
        <nav class="website-navigation-sub-menu level-2" 
          id="sub-menu-services-{{loop.index}}"
        >
          <a href='javascript:;'
            class="menu-link trigger back-button" 
            id="sub-menu-toggle-{{loop.index}}"
            aria-controls="sub-menu-services-{{loop.index}}"
            aria-expanded="false"
            {{ isActiveNode(item.link.href) if item.link.href }}  
          >
            {{ item.title }}
          </a>
          
          {% if item.submenu.promotional_text %}
            <div class="promotional-section">
              <h2>{{ item.title }}</h2>
              <p>
                {{ item.submenu.promotional_text }}
              </p>

              {% if item.submenu.button.button_type %}
                <div class="custom-btn custom-btn--{{ item.submenu.button.button_style }}">
                  {% if item.submenu.button.button_type == "std" %}
                    {% set href = item.submenu.button.link_field.url.href %}
                
                    <a href="{{ href }}"
                      {% if item.submenu.button.link_field.open_in_new_tab %}target="_blank"{% endif %}
                      {% if item.submenu.button.link_field.rel %}rel="{{ item.submenu.button.link_field.rel }}"{% endif %}
                      class="{{ item.submenu.button.button_style }}"
                    >
                      {{ item.submenu.button.text_field }} 
                      {% if item.submenu.button.button_style is string_containing "text-cta-primary" %}
                        <i class="las la-arrow-right"></i>
                      {% endif %}
                    </a>
                  {% elif item.submenu.button.button_type == "cta" %}
                    {% cta guid="{{ item.submenu.button.cta_field }}" %}
                  {% endif %}
                </div>
              {% endif %}
            </div>
          {% endif %}
          
          <ul class="submenu{% if submenu|length <= 4 %} two-columns{% endif %}">
            {% for node in submenu %} 
              {{ link(node) }}
            {% endfor %}
          </ul>
        </nav>
      </li>
    {% endfor %} 
  </ul>
</nav>
